{"componentChunkName":"component---src-templates-post-jsx","path":"/useing-mobx-correctly/","result":{"data":{"site":{"siteMetadata":{"title":"Lanky.Blog"}},"markdownRemark":{"id":"31de2775-a601-59bc-8c08-d1ec78a276d2","excerpt":"이번에 면접 과제를 진행하면서 MobX를 처음 써보았습니다. MobX 공식문서와 유튜브 강의를 보면서 구현해 보았는데 과연 내가 제대로 사용하는가가 궁금해졌습니다. 그래서 다시 공식문서를 보면서 복기하고 리팩토링을 해보려고 합니다. ✅ 과제 코드가 외부에 공개될 수도 있으므로 공식문서에 나온 예제로 예시를 보여드립니다. 1. Observable State…","html":"<p>이번에 면접 과제를 진행하면서 MobX를 처음 써보았습니다. <a href=\"https://ko.mobx.js.org/\">MobX 공식문서</a>와 유튜브 강의를 보면서 구현해 보았는데 과연 내가 제대로 사용하는가가 궁금해졌습니다. 그래서 다시 공식문서를 보면서 복기하고 리팩토링을 해보려고 합니다.</p>\n<p>✅ 과제 코드가 외부에 공개될 수도 있으므로 공식문서에 나온 예제로 예시를 보여드립니다.</p>\n<h1>1. Observable State 만들기</h1>\n<h2>내가 선택한 방식</h2>\n<p><code class=\"language-text\">class + makeObservable</code> 방식으로 사용했습니다. 강의나 공식문서에서 많이 등장하였고 공식문서 내의 <a href=\"https://ko.mobx.js.org/observable-state.html#%ED%81%B4%EB%9E%98%EC%8A%A4%EC%97%90-%EB%8C%80%ED%95%9C-%EC%A7%A7%EC%9D%80-%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">클래스에 대한 짧은 참고자료</a>을 읽고 typescript와 객체지향 프로그래밍을 시도하기 위해서 이 방식으로 선택했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// class.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> makeObservable<span class=\"token punctuation\">,</span> observable<span class=\"token punctuation\">,</span> computed<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">,</span> flow <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"mobx\"</span>  \n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Doubler</span> <span class=\"token punctuation\">{</span>  \n\tlist<span class=\"token operator\">:</span> List<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\tsortType <span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token constant\">DEFAULT_SORT_TYPE</span>\n\t\n\t<span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t\t<span class=\"token function\">makeObservable</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>  \n\t\t\tlist<span class=\"token operator\">:</span> observable<span class=\"token punctuation\">,</span>\n\t\t\tsortType<span class=\"token operator\">:</span> observable<span class=\"token punctuation\">,</span>\n\t\t\tgetTotalListCount<span class=\"token operator\">:</span> computed<span class=\"token punctuation\">,</span>  \n\t\t\tsetDefaultSortType<span class=\"token operator\">:</span> action<span class=\"token punctuation\">,</span>  \n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  \n\t<span class=\"token punctuation\">}</span>  \n  \n\t<span class=\"token keyword\">get</span> <span class=\"token function\">getTotalListCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>list<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span>  \n\t<span class=\"token punctuation\">}</span> \n  \n\t<span class=\"token function\">setDefaultSortType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sortType <span class=\"token operator\">=</span> <span class=\"token constant\">DEFAULT_SORT_TYPE</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>공식문서의 Proxy 객체로 감싸지지 않는다고 하였는데 클래스 내부의 상태가 배열일 경우에는 Proxy 객체로 감싸져있더군요. 이번에 글을 작성하면서 <code class=\"language-text\">toJS(value)</code> 메서드를 알게되었습니다. 메서드를 사용하면 Proxy 객체로 wrapping 되어 있지 않습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 501px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/84a51a4c04c3e0a230ebadf9fab9bca3/56272/img_47.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 37.64705882352941%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeUlEQVQozz1S6XqCQAzkUeoByOEtyiGogIJ4t9Z+7fu/xzQTa3/k293szmQmWaPTtWH3PPQcX6Nr9jQs29Gz5w9k7+Kt1QXfct8fjJFmOaIkwzxMEMxjxMsVJrMFDK8/wul8Q7bKUZQ16v0RdXNCczijqg/Iywq7qsEm36KSu8PxgnK3x3bX6D3358s7LtcPIY5gOG4f5bb+BxcSabbBQiqTfCuAvNhhIxFGS6RSeC8FiSkk+JZExFGlMZ4EOJ6uTwtxqisVP75+FEjlzFMJ85+Pby3EfCyW15tSFd4lP6Vl1xsoc5KuVeX1dtcCBCxE0Xgyx2pdqEpapqJpEGq/MsmTjIX20iLPHz4tV3/WaIMrCUzLgS1DsWwPpgyCgzItFx1ZOUQOh0MbDCegKA6KXAaBw9FUCdodC622qWBbAJz0k8hRgtdKolDasJT20F2wiMVNKgpHzx6yD+wTI5EH7E30CsnxzDxJlEjaMxPbJKY6V6z68lv4rX4Bf5oLyuApXqMAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img 47' title='img 47' src='/static/84a51a4c04c3e0a230ebadf9fab9bca3/56272/img_47.png' srcset='/static/84a51a4c04c3e0a230ebadf9fab9bca3/e7570/img_47.png 170w,\n/static/84a51a4c04c3e0a230ebadf9fab9bca3/f46e7/img_47.png 340w,\n/static/84a51a4c04c3e0a230ebadf9fab9bca3/56272/img_47.png 501w' sizes='(max-width: 501px) 100vw, 501px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n</blockquote>\n<h2>이런 방식도 있더군요?</h2>\n<h3><code class=\"language-text\">makeAutoObservable</code></h3>\n<p><code class=\"language-text\">factory function + makeAutoObservable</code> 방식입니다.  공식문서의 탭에서 예제를 확인해보실 수 있습니다. 마치 typescript의 타입 추론처럼 알아서 모든 속성(property)을 기본적으로 추론합니다.</p>\n<blockquote>\n<p>속성(property)과 행동(action)은 MobX에서 다른 개념입니다.\n위 코드의 <code class=\"language-text\">list</code>, <code class=\"language-text\">sortType</code>을 속성이라고 하고 <code class=\"language-text\">setDefaultSortType</code>을 행동이라고 합니다.</p>\n</blockquote>\n<h3><code class=\"language-text\">observable</code></h3>\n<p><code class=\"language-text\">obsevable</code> 방식입니다. 객체에 필드를 추가거나 제거를 할 수 있습니다. 아래 코드처럼 사용할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> todosById <span class=\"token operator\">=</span> <span class=\"token function\">observable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>  \n\t<span class=\"token string-property property\">\"TODO-123\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>  \n\t\ttitle<span class=\"token operator\">:</span> <span class=\"token string\">\"find a decent task management system\"</span><span class=\"token punctuation\">,</span>  \n\t\tdone<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>  \n\t<span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  \n  \ntodosById<span class=\"token punctuation\">[</span><span class=\"token string\">\"TODO-456\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>  \n\ttitle<span class=\"token operator\">:</span> <span class=\"token string\">\"close all tickets older than two weeks\"</span><span class=\"token punctuation\">,</span>  \n\tdone<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>간단한 프로젝트에서는 사용하기 좋을 듯하나 프로젝트의 크기가 커지면 상태를 어디서 어떻게 바꾸었는지 찾는데 오래 걸릴 듯합니다.</p>\n</blockquote>\n<h2>나의 결론 : 접근 방식은 모두 유효하다.</h2>\n<p>다만 프로젝트의 복잡성과 크기, 컨셉에 따라 사용 방식을 다르게 하는 것이 좋을 듯합니다.</p>\n<h1>2. action을 이용한 state 업데이트</h1>\n<h2>내가 선택한 방식</h2>\n<p>클래스를 정의할 때 action을 선언해야 합니다. 다만 action은 state를 수정하려는 함수에서만 사용해야 합니다.\n또, 제가 생각하는 클래스를 이용한 상태관리는 UI 컴포넌트에서 직접 상태를 수정하면 안됩니다. 클래스 내부의 메서드를 통해서 상태가 수정되어야 한다고 생각합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// ✅ 좋은 예 </span>\n<span class=\"token comment\">// Doubler 클래스 내부</span>\n<span class=\"token function\">setDefaultSortType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// action 선언 후</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sortType <span class=\"token operator\">=</span> <span class=\"token constant\">DEFAULT_SORT_TYPE</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// UI 컴포넌트</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sortTypeHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\tboubler<span class=\"token punctuation\">.</span><span class=\"token function\">setDefaultSortType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ❌ 나쁜 예</span>\n<span class=\"token comment\">// UI 컴포넌트 : 직접 상태 값에 접근</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sortTypeHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\tboubler<span class=\"token punctuation\">.</span>sortType <span class=\"token operator\">=</span> <span class=\"token constant\">DEFAULT_SORT_TYPE</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>이런 방식도 있더군요2?</h2>\n<h3><code class=\"language-text\">action</code> 함수를 이용한 함수 래핑</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 내가 사용한 방식</span>\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">sortTypeHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">리셋</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>butoon</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n)\n\n// action 함수 wrapping\n\nreturn (\n\t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">sortTypeHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">리셋</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>butoon</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n)</span></code></pre></div>\n<p>MobX의 트랜잭션 특성을 최대한 활용하려면 action을 최대한 외부로 전달해야 합니다. 여기서 이야기하는 트랜잭션 특성이란 관찰 가능한 여러 상태 변경을 단일 작업으로 일괄 처리하는 기능을 나타냅니다. 이로 인해 얻을 수있는 이득은 다음과 같습니다.</p>\n<ol>\n<li>작업이 여러 상태 변경을 트리거하는 경우 MobX는 이러한 모든 변경 사항을 함께 그룹화하고 단일 원자 작업으로 실행합니다.</li>\n<li>개별 상태가 변경된 후가 아니라 트랜잭션이 끝날 때 한 번만 업데이트됩니다. 이는 불필요한 재렌더링을 줄이고 성능을 향상시킵니다.</li>\n<li>작업 실행 중에 오류가 발생하면 MobX는 해당 작업 중에 이루어진 모든 변경 사항을 롤백하여 관찰 가능한 상태가 일관되게 유지되도록 합니다.</li>\n<li>작업이 다른 작업을 호출하는 경우 중첩된 작업 내에서 변경된 사항은 동일한 트랜잭션의 일부로 처리됩니다. 이는 작업이 서로 구성되거나 호출되는 경우에도 트랜잭션 무결성을 유지하는 데 도움이 됩니다.</li>\n</ol>\n<blockquote>\n<p>트랜잭션이란 특성으로 인해 필수적이라고 생각됩니다. 하지만 저의 코드는 단순한 상태변경이 대부분이었습니다. 이로 인한 성능 향상은 미미할 수 있고 불필요한 상용구 코드가 생성될 것입니다.\n기억해두었다가 성능, 일관성 및 예측 가능성 측면의 처리가 필요하다면 써봐야겠습니다.</p>\n</blockquote>\n<h3><code class=\"language-text\">action.bound</code></h3>\n<p><code class=\"language-text\">this</code>가 항상 함수 내에서 적절하게 바인딩 될 수 있도록 메서드를 올바른 인스턴스에 바인딩하는 데 사용됩니다.</p>\n<p>❗️ 클래스 인스턴스에 상태, 메서드를 구조 분해 할당방식으로 사용하고 싶었습니다. 렌더링에는 문제가 없었는데 리셋버튼을 누르니까 에러가 났습니다. 즉, 컴파일에는 문제가 없었는데 <code class=\"language-text\">sortTypeHandler()</code> 함수를 사용하면 <code class=\"language-text\">Uncaught TypeError: Cannot set properties of undefined (setting 'sortType')</code> 에러메시지가 나왔습니다.\n구조 분해 할당을 사용하지 않으면 문제는 없었습니다.</p>\n<p>그 때는 '뭐지..?' 하고 넘어갔는데 이제 알게 되었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 내가 작성한 예 : 결론적으로 나쁜 예시 ❌</span>\n<span class=\"token comment\">// UI 컴포넌트</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> boubler <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// const {boubler : { setDefaultSortType }} = useStore();</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sortTypeHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\tboubler<span class=\"token punctuation\">.</span><span class=\"token function\">setDefaultSortType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\">// 구조 분해 할당으로 메서드를 할당하고 싶었습니다.</span>\n\t<span class=\"token comment\">// setDefaultSortType()</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">sortTypeHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">리셋</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>butoon</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n)\n\n// 클래스 내부\n\tsetDefaultSortType: action\n\n\tsetDefaultSortType() </span><span class=\"token punctuation\">{</span>  \n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sortType <span class=\"token operator\">=</span> <span class=\"token constant\">DEFAULT_SORT_TYPE</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token plain-text\">  </span></code></pre></div>\n<p>✅ 구조 분해 할당을 사용하기 위한 <code class=\"language-text\">this</code> 바인딩</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 클래스 내부</span>\n\t<span class=\"token function\">setDefaultSortType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sortType <span class=\"token operator\">=</span> <span class=\"token constant\">DEFAULT_SORT_TYPE</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span> \n\t\n<span class=\"token comment\">// UI 컴포넌트</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">boubler</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> setDefaultSortType <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> destructuring <span class=\"token operator\">=</span> <span class=\"token function\">useStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>boubelr<span class=\"token punctuation\">.</span>setDefaultSortType<span class=\"token punctuation\">;</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>setDefaultSortType <span class=\"token operator\">===</span> destructuring<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span>\n\n<span class=\"token function\">destructuring</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// this == undefined</span></code></pre></div>\n<p>자바스크립트의 <code class=\"language-text\">this</code>는 함수의 실행 문맥에 따라갑니다. 이야기하면 길지만 자바스크립트 엔진이 실행 가능한 코드를 만났을 때 <code class=\"language-text\">실행 컨텍스트</code>(Excution Context)를 생성하고 그 과정 중에 this 값을 설정(바인딩)을 합니다.</p>\n<p>위의 내용대로라면 변수 <code class=\"language-text\">destructuring</code> 는 클래스 객체가 바인딩이 되어 있는 상태가 아닌겁니다.(참조한다, 가르킨다라는 표현으로 사용도 합니다.)<br>\n기본값인 window 객체로 바인딩이 될 것이지만 출력을 시도하면 undefined가 됩니다.</p>\n<p>그래서 컴파일할 때 문제가 없다가 함수를 실행하면 에러가 나는 겁니다. 아이 부끄러워라.😂\n(켰을 때는 문제가 없는데 버튼을 누르니까 에러가 나는거죠. )</p>\n<p>그럼 어떻게 바꾸어야 할까요?</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// 좋은 예 👍</span>\n<span class=\"token comment\">// 클래스 내부: 편의상 변경 부분만 적었습니다.</span>\n\tsetDefaultSortType<span class=\"token operator\">:</span> action<span class=\"token punctuation\">.</span>bound\n\n\t<span class=\"token function\">setDefaultSortType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sortType <span class=\"token operator\">=</span> <span class=\"token constant\">DEFAULT_SORT_TYPE</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>  \n\n<span class=\"token comment\">// UI 컴포넌트</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> boubler <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> setDefaultSortType <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">sortTypeHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token function\">setDefaultSortType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위 코드처럼 변경하면 구조 분해 할당도 사용할 수 있고 올바른 인스턴스도 바인딩할 수 있게 됩니다.</p>\n<blockquote>\n<p>꼭 구조 분해 할당을 위해서가 아니라도 사용해야 한다고 생각합니다. 코드의 문맥을 위해 구조 분해 할당을 사용하지 않았지만 잠재적인 문제를 피하는 데 도움이 될 수 있습니다.</p>\n</blockquote>\n<h4>비동기 action</h4>\n<p>본질적으로 비동기 프로세스에 대해 특별한 처리가 필요하지 않습니다. 하지만 여러 비동기 작업을 처리할 때를 생각한다면 observable를 업데이트하는 모든 단계에 action을 표시하는 것을 권장합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// 내가 사용한 예 : 잘못된 예 ❌</span>\n<span class=\"token comment\">// 클래스 내부</span>\n<span class=\"token function\">fetchList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token function\">getListFromServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Promise를 리턴하는 비동기 함수</span>\n\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>  \n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>list <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span>  \n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>  \n\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 좋은 예시 👍 : 1</span>\n<span class=\"token comment\">// 프라미스 해결 핸들러는 인라인으로 처리되지만 </span>\n<span class=\"token comment\">// 원래 작업이 완료된 후에 실행되므로 `action`으로 래핑해야 합니다.</span>\n<span class=\"token function\">fetchList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token function\">getListFromServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Promise를 리턴하는 비동기 함수</span>\n\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fetchSuccess'</span><span class=\"token punctuation\">,</span> data <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>list <span class=\"token operator\">=</span> data<span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>  \n\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token function\">action</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// then()의 첫번째 인자는 성공했을 때, 두번째 인자는 실패했을 때입니다.</span>\n<span class=\"token function\">fetchList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token function\">getListFromServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// Promise를 리턴하는 비동기 함수</span>\n\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>successAction<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>failAction<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\">// async/await를 사용한다면?</span>\n<span class=\"token comment\">// `await` 이후 단계가 동일하지 않기 때문에 action 래핑이 필요합니다. </span>\n<span class=\"token comment\">// 여기에서 `runInAction`을 활용할 수 있습니다.</span>\n<span class=\"token keyword\">async</span> <span class=\"token function\">fetchList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>  \n\t\t<span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getListFromServer</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\t\t<span class=\"token function\">runInAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>list <span class=\"token operator\">=</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \n\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>  \n\t\t<span class=\"token function\">runInAction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>꼭 적용해야 된다고 생각합니다. 원래 작성한 코드는 다행히 정상 작동을 하였습니다. 하지만 비동기 작업이 복잡하고 여러 상태를 변경하였다면 문제가 생겼을 수도 있을 것 같습니다.</p>\n</blockquote>\n<h3>나의 결론 : <code class=\"language-text\">action.bound</code>, <code class=\"language-text\">비동기 action</code>은 필수!</h3>\n<p><code class=\"language-text\">action wrapping</code>은 선택! 성능의 이슈가 생긴다면 꼭 할 것!</p>","frontmatter":{"title":"제대로 MobX를 사용하고 있습니까?","date":"July 31, 2023","update":"July 31, 2023","tags":["MobX","observable","상태관리","mobx action"],"series":"MobX"},"fields":{"slug":"/useing-mobx-correctly/","readingTime":{"minutes":12.78}}},"seriesList":{"edges":[{"node":{"id":"31de2775-a601-59bc-8c08-d1ec78a276d2","fields":{"slug":"/useing-mobx-correctly/"},"frontmatter":{"title":"제대로 MobX를 사용하고 있습니까?"}}}]},"previous":{"fields":{"slug":"/kakao-map-api/"},"frontmatter":{"title":"카카오 Maps API를 이용하여 경로 표시하기"}},"next":null},"pageContext":{"id":"31de2775-a601-59bc-8c08-d1ec78a276d2","series":"MobX","previousPostId":"15bd1982-8911-5276-a3e8-1c0dc2e09f23","nextPostId":null}},"staticQueryHashes":[]}